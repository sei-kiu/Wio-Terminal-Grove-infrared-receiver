#include <Arduino.h>

#include "../include/Free_Fonts.h" //include free fonts library from https://github.com/Seeed-Studio/Seeed_Arduino_LCD/blob/master/examples/320x240/Free_Font_Demo/Free_Fonts.h
#include "TFT_eSPI.h"

#include "IRremote.h"

TFT_eSPI tft;

int IR_RECEIVE_PIN = 0;

IRrecv irrecv(IR_RECEIVE_PIN);

String buttonDetected(unsigned long resultsValue);
void dumpCode(decode_results *results);
void updateScreen(decode_results *results);

void setup()
{
  // put your setup code here, to run once:

  // set up screen
  tft.begin();
  tft.setRotation(2);

  // Start serial
  Serial.begin(9600);

  // Start the receiver
  irrecv.enableIRIn();
}

void loop()
{
  // put your main code here, to run repeatedly:

  decode_results results; // Somewhere to store the results

  if (irrecv.decode(&results))
  {                     // Grab an IR code
    dumpCode(&results); // Output the results as source code
    irrecv.resume();    // Prepare for the next value
  }

  updateScreen(&results);
}

//+=============================================================================
// Dump out the decode_results structure.
//
void dumpCode(decode_results *results)
{
  // Start declaration
  Serial.print("results value: ");
  Serial.print(results->value);
  Serial.println("");                     // Newline
  Serial.print("unsigned int");           // variable type
  Serial.print(" rawData[");              // array name
  Serial.print(results->rawlen - 1, DEC); // array size
  Serial.print("] = {");                  // Start declaration

  // Dump data
  for (unsigned int i = 1; i < results->rawlen; i++)
  {
    Serial.print(results->rawbuf[i] * MICROS_PER_TICK, DEC);
    if (i < results->rawlen - 1)
      Serial.print(","); // ',' not needed on last one
    if (!(i & 1))
      Serial.print(" ");
  }

  Serial.print("};"); //End declaration

  Serial.println(""); // Newline
  Serial.println("");
}

void updateScreen(decode_results *results)
{
  //Initializing buffer
  TFT_eSprite spr = TFT_eSprite(&tft);

  // Create buffer (portrait)
  spr.createSprite(TFT_WIDTH, TFT_HEIGHT);

  // Fill background
  spr.fillSprite(TFT_YELLOW);

  // Header section
  spr.fillRect(0, 0, 240, 30, TFT_WHITE);
  spr.setFreeFont(FMB12);
  spr.setTextColor(TFT_BLACK);
  spr.drawString("Grove IR Receiver", 5, 6);

  // Body section
  spr.setFreeFont(FMB18);
  spr.setTextDatum(MC_DATUM);
  spr.drawString("Value", 120, 60);
  spr.drawString("detected", 120, 90);
  spr.drawString((String)results->value, 120, 120);
  spr.setFreeFont(FMB18);
  spr.setTextDatum(MC_DATUM);
  spr.drawString("Button", 120, 180);
  spr.drawString("detected", 120, 210);
  spr.drawString(buttonDetected(results->value), 120, 240);

  //Push to LCD
  spr.pushSprite(0, 0);

  // Delete buffer
  spr.deleteSprite();
}

String buttonDetected(unsigned long resultsValue)
{
  if (resultsValue == 16753245)
  { // unsigned int buttonPower[67] = {9200,4500, 600,550, 600,600, 600,550, 600,550, 650,550, 600,550, 600,600, 600,550, 600,1650, 600,1650, 600,1650, 600,1650, 600,1650, 600,1650, 600,1650, 600,1650, 600,1650, 600,600, 600,1650, 600,550, 600,550, 600,600, 600,1650, 600,550, 600,550, 650,1600, 650,550, 600,1650, 600,1650, 600,1650, 600,550, 650,1600, 600};
    return "Power";
  }
  else if (resultsValue == 16736925)
  { // unsigned int buttonMode[67] = {9200,4500, 600,550, 650,550, 600,550, 650,550, 600,550, 600,550, 650,550, 600,550, 600,1650, 650,1600, 600,1650, 650,1600, 650,1600, 650,1600, 650,1650, 600,1650, 600,550, 600,1650, 600,1650, 600,550, 650,550, 600,550, 600,1650, 600,600, 600,1650, 600,550, 600,550, 650,1600, 650,1600, 650,1600, 650,550, 600,1650, 600};
    return "Mode";
  }
  else if (resultsValue == 16769565)
  { // unsigned int buttonMute[67] = {9200,4500, 600,600, 600,550, 600,550, 600,600, 600,550, 600,550, 650,550, 600,550, 650,1600, 600,1650, 650,1600, 650,1600, 650,1600, 650,1600, 650,1650, 600,1650, 600,1650, 600,1650, 600,1650, 600,550, 600,550, 650,550, 600,1650, 600,550, 600,600, 600,550, 600,550, 650,1600, 650,1600, 650,1600, 650,550, 600,1650, 600};
    return "Mute";
  }
  else if (resultsValue == 16720605)
  { // unsigned int buttonPlayPause[67] = {9250,4450, 600,600, 600,550, 600,550, 650,550, 600,550, 600,600, 600,550, 600,550, 650,1600, 650,1650, 600,1650, 600,1650, 600,1650, 600,1650, 600,1650, 600,1650, 600,550, 600,550, 650,1600, 650,550, 600,550, 600,600, 600,1650, 600,550, 600,1650, 600,1650, 600,550, 650,1600, 650,1600, 650,1600, 650,550, 600,1650, 600};
    return "PlayPause";
  }
  else if (resultsValue == 16712445)
  { // unsigned int buttonPrevious[67] = {9200,4450, 650,550, 600,550, 600,600, 600,550, 600,550, 600,600, 600,550, 600,550, 650,1600, 650,1600, 600,1650, 650,1600, 650,1600, 650,1600, 650,1600, 650,1600, 650,550, 600,550, 600,600, 600,550, 600,550, 650,550, 600,1650, 600,550, 600,1650, 600,1650, 600,1650, 650,1600, 650,1600, 650,1600, 600,600, 600,1650, 600};
    return "Previous";
  }
  else if (resultsValue == 16761405)
  { // unsigned int buttonNext[67] = {9200,4450, 650,550, 650,500, 650,550, 600,550, 650,500, 650,550, 600,550, 650,500, 650,1600, 650,1600, 650,1600, 650,1600, 650,1600, 650,1600, 650,1600, 650,1600, 650,1600, 650,1600, 650,550, 600,550, 650,550, 600,550, 650,1600, 650,500, 650,550, 650,500, 650,1600, 650,1600, 650,1600, 650,1600, 650,550, 600,1650, 600};
    return "Next";
  }
  else if (resultsValue == 16769055)
  { // unsigned int buttonEQ[67] = {9250,4450, 600,600, 600,550, 600,600, 600,550, 600,550, 650,550, 600,550, 600,550, 650,1600, 650,1600, 650,1650, 600,1650, 600,1650, 600,1650, 600,1650, 600,1650, 600,1650, 600,1650, 600,1650, 600,550, 600,550, 650,550, 600,550, 600,600, 600,550, 600,550, 600,600, 600,1650, 600,1650, 600,1650, 600,1650, 600,1650, 600};
    return "EQ";
  }
  else if (resultsValue == 16754775)
  { // unsigned int buttonMinus[67] = {9250,4450, 650,500, 650,550, 650,500, 650,550, 600,550, 650,500, 650,550, 650,500, 650,1600, 650,1600, 650,1600, 650,1600, 650,1600, 650,1600, 650,1600, 650,1600, 650,1600, 650,550, 650,1600, 650,500, 650,1600, 650,550, 600,550, 650,500, 650,550, 650,1600, 650,500, 650,1600, 650,550, 600,1650, 650,1600, 600,1650, 650};
    return "Minus";
  }
  else if (resultsValue == 16748655)
  { // unsigned int buttonPlus[67] = {9250,4450, 650,550, 650,500, 650,550, 600,550, 600,550, 650,550, 650,500, 650,550, 600,1650, 600,1650, 650,1600, 600,1650, 650,1600, 650,1600, 650,1600, 650,1600, 650,1600, 650,550, 600,550, 650,1600, 650,500, 650,550, 650,500, 650,550, 600,550, 650,1600, 650,1600, 650,550, 600,1650, 600,1650, 600,1650, 600,1650, 600};
    return "Plus";
  }
  else if (resultsValue == 16738455)
  { // unsigned int button0[67] = {9200,4500, 600,550, 650,550, 600,550, 600,600, 600,550, 600,550, 650,550, 600,550, 600,1650, 600,1650, 600,1650, 600,1650, 600,1650, 600,1650, 650,1600, 600,1650, 600,600, 600,1650, 600,1650, 600,550, 600,1650, 600,550, 650,550, 600,550, 600,1650, 650,550, 600,550, 600,1650, 600,550, 650,1600, 650,1600, 650,1600, 650};
    return "0";
  }
  else if (resultsValue == 16750695)
  { // unsigned int buttonShuffle[67] = {9200,4500, 650,500, 650,550, 600,550, 650,500, 650,550, 650,500, 650,550, 600,550, 650,1600, 650,1600, 600,1650, 600,1650, 600,1650, 600,1650, 600,1650, 600,1650, 650,1600, 650,550, 650,500, 650,1600, 650,1600, 650,550, 600,550, 650,500, 650,550, 650,1600, 650,1600, 650,500, 650,550, 600,1650, 600,1650, 600,1650, 600};
    return "Shuffle";
  }
  else if (resultsValue == 16756815)
  { // unsigned int buttonUSD[67] = {9250,4450, 600,550, 650,550, 600,550, 650,500, 650,550, 600,550, 650,500, 650,550, 650,1600, 650,1600, 600,1650, 600,1650, 650,1600, 650,1600, 600,1650, 600,1650, 650,1600, 650,500, 650,1600, 650,1600, 650,550, 600,550, 650,500, 650,550, 600,550, 650,1600, 650,500, 650,550, 650,1600, 600,1650, 600,1650, 650,1600, 600};
    return "USD";
  }
  else if (resultsValue == 16724175)
  { // unsigned int button1[67] = {9300,4400, 650,550, 600,550, 650,550, 600,550, 650,500, 650,550, 650,500, 650,500, 650,1600, 650,1600, 650,1600, 650,1650, 600,1650, 600,1650, 600,1650, 600,1650, 600,550, 650,500, 650,1600, 650,1600, 650,550, 600,550, 650,550, 600,550, 650,1600, 650,1600, 650,500, 650,550, 600,1650, 600,1650, 600,1650, 650,1600, 600};
    return "1";
  }
  else if (resultsValue == 16718055)
  { // unsigned int button2[67] = {9300,4450, 650,500, 650,550, 600,550, 650,550, 600,550, 650,500, 650,550, 650,500, 650,1600, 650,1600, 650,1600, 650,1600, 650,1600, 650,1600, 650,1600, 650,1600, 650,550, 600,550, 650,550, 600,1650, 600,1650, 600,550, 650,500, 650,550, 600,1650, 650,1600, 650,1600, 600,550, 600,600, 650,1600, 600,1650, 600,1650, 650};
    return "2";
  }
  else if (resultsValue == 16743045)
  { // unsigned int button3[67] = {9250,4450, 650,500, 650,550, 650,500, 650,500, 650,550, 650,500, 650,550, 650,500, 650,1600, 650,1600, 600,1650, 650,1600, 650,1600, 600,1650, 600,1650, 650,1600, 600,550, 650,1600, 700,1550, 650,1600, 650,1600, 650,550, 600,1650, 600,550, 650,1600, 650,500, 650,550, 650,500, 650,500, 650,1600, 650,550, 600,1650, 650};
    return "3";
  }
  else if (resultsValue == 16716015)
  { // unsigned int button4[67] = {9250,4450, 650,500, 650,550, 650,500, 650,550, 600,550, 650,500, 650,550, 650,500, 650,1600, 650,1600, 650,1600, 650,1600, 650,1600, 650,1600, 650,1600, 650,1600, 650,550, 600,550, 650,500, 650,1600, 650,550, 650,500, 650,550, 600,550, 650,1600, 650,1600, 650,1600, 650,500, 650,1600, 650,1600, 650,1600, 650,1600, 650};
    return "4";
  }
  else if (resultsValue == 16726215)
  { // unsigned int button5[67] = {9300,4450, 650,500, 650,550, 650,500, 650,550, 600,550, 650,500, 650,550, 650,500, 650,1600, 650,1600, 650,1600, 650,1650, 650,1600, 600,1650, 650,1600, 650,1600, 650,500, 650,550, 650,1600, 650,1600, 650,1600, 650,550, 700,450, 700,500, 600,1650, 600,1650, 650,500, 650,550, 600,550, 650,1600, 650,1600, 650,1600, 650};
    return "5";
  }
  else if (resultsValue == 16734885)
  { // unsigned int button6[67] = {9200,4500, 650,550, 650,500, 650,550, 600,550, 600,550, 650,550, 600,550, 650,550, 600,1650, 600,1650, 600,1650, 600,1650, 600,1650, 600,1650, 600,1650, 600,1650, 650,550, 600,1650, 600,550, 600,1650, 650,1600, 650,550, 600,1650, 650,500, 650,1600, 650,550, 600,1650, 650,500, 650,550, 600,1650, 650,500, 650,1600, 650};
    return "6";
  }
  else if (resultsValue == 16728765)
  { // unsigned int button7[67] = {9250,4450, 600,600, 600,550, 650,500, 650,550, 600,550, 650,550, 600,550, 600,550, 650,1600, 650,1650, 600,1650, 600,1650, 600,1650, 650,1600, 650,1600, 600,1650, 600,550, 650,1600, 650,550, 600,550, 650,550, 600,550, 650,1600, 650,550, 600,1650, 600,550, 600,1650, 650,1600, 600,1650, 650,1600, 650,550, 600,1650, 600};
    return "7";
  }
  else if (resultsValue == 16730805)
  { // unsigned int button8[67] = {9250,4450, 600,550, 650,550, 600,550, 650,500, 650,550, 650,500, 650,550, 600,550, 600,1650, 600,1650, 600,1650, 600,1650, 600,1650, 600,1650, 600,1650, 600,1650, 600,600, 600,1650, 600,550, 650,550, 600,1650, 600,550, 600,1650, 650,500, 650,1600, 650,550, 600,1650, 600,1650, 650,500, 650,1600, 650,550, 600,1650, 600};
    return "8";
  }
  else if (resultsValue == 16732845)
  { // unsigned int button9[67] = {9250,4450, 650,550, 600,550, 650,500, 650,550, 650,500, 650,550, 600,550, 650,500, 650,1600, 650,1600, 650,1650, 600,1650, 600,1650, 600,1650, 600,1650, 600,1650, 600,550, 650,1600, 650,550, 600,1650, 600,550, 650,500, 650,1600, 650,550, 650,1600, 650,500, 650,1600, 650,550, 600,1650, 650,1600, 600,550, 650,1600, 650};
    return "9";
  }
  else if (resultsValue == 4294967295)
  { // unsigned int buttonLongPress[3] = {9200,2200, 650};
    return "Long Press";
  }
  else
  {
    return "UNKNOWN";
  }
}